@model IEnumerable<WebCoba.Models.UserView>

@section styles {
    <link href="~/Content/Features/home.css" rel="stylesheet" />
}

<div class="inv-header-section mt-4">
    <h2>Manajemen Pengguna</h2>
</div>

<div class="inv-action-bar mb-3">
    <div class="row justify-content-end">
        <div class="col-md-5">
            @using(Html.BeginForm("Index", "Admin", FormMethod.Get, new { @class = "m-0" })) {
                <div class="search-wrapper">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" name="search" class="form-control" placeholder="Cari username..." value="@ViewBag.CurrentSearch" />
                    <div class="ms-2">
                        @Html.GButton("Cari", variant: "dark", htmlAttributes: new { type = "submit" })
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<div class="inv-table-card shadow-sm">
    <div class="table-responsive">
        <table class="table" id="productTable">
            <thead>
                <tr>
                    <th style="width: 30%">
                        <a href="@Url.Action("Index", new { sortOrder = ViewBag.NameSort, search = ViewBag.CurrentSearch })" class="text-decoration-none text-dark">
                            Username <i class="fas fa-sort ms-1 small text-muted"></i>
                        </a>
                    </th>
                    <th style="width: 30%">User ID (System)</th>
                    <th>Role</th>
                    <th class="text-center">Aksi</th>
                </tr>
            </thead>
            <tbody>
                @foreach(var user in Model) {
                    <tr>
                        <td class="fw-bold text-dark">
                            <i class="fas fa-user-circle me-2 @(user.IsSuspended ? "text-danger" : "text-secondary")"></i>
                            @user.Username
                            @if(user.IsSuspended) {
                                <span class="badge bg-danger ms-1" style="font-size: 10px;">SUSPENDED</span>
                            }
                        </td>
                        <td><code class="small text-muted">@user.UserId</code></td>
                        <td>
                            <span class="badge rounded-pill bg-light @(user.RoleName == "Admin" ? "text-danger border-danger" : "text-primary border-primary") border border-opacity-25 px-3">
                                <i class="fas @(user.RoleName == "Admin" ? "fa-user-shield" : "fa-user") me-1"></i>
                                @user.RoleName
                            </span>
                        </td>
                        <td class="text-center">
                            <div class="d-flex gap-2 justify-content-center">
                                @if(user.RoleName != "Admin") {
                                    <a href="@Url.Action("ViewUserInventory", "Admin", new { targetUsername = user.Username })">
                                        @Html.GButton("", variant: "info", size: "sm", icon: "fas fa-database")
                                    </a>

                                    <div class="dropdown">
                                        <button class="btn btn-sm btn-outline-danger border" type="button" data-bs-toggle="dropdown">
                                            <i class="fas fa-user-slash"></i>
                                        </button>
                                        <ul class="dropdown-menu shadow border-0 p-2">
                                            @using(Html.BeginForm("SuspendUser", "Admin", FormMethod.Post)) {
                                                @Html.AntiForgeryToken()
                                                <input type="hidden" name="userId" value="@user.UserId" />
                                                <li><button type="submit" name="days" value="1" class="dropdown-item small">1 Hari</button></li>
                                                <li><button type="submit" name="days" value="7" class="dropdown-item small">1 Minggu</button></li>
                                                <li><button type="submit" name="days" value="-1" class="dropdown-item small text-danger fw-bold">Permanen</button></li>
                                            }
                                        </ul>
                                    </div>

                                    using(Html.BeginForm("UnsuspendUser", "Admin", FormMethod.Post)) {
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="userId" value="@user.UserId" />
                                        <button type="submit" class="btn btn-sm btn-outline-success border" title="Lepas Suspend">
                                            <i class="fas fa-user-check"></i>
                                        </button>
                                    }
                                } else {
                                    @* Placeholder agar lebar kolom tetap konsisten atau beri info *@
                                    <span class="badge bg-light text-muted border py-2 px-3" style="font-size: 11px;">
                                        <i class="fas fa-shield-alt"></i> Protected
                                    </span>
                                }
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    @if(ViewBag.TotalPages > 1) {
        <div class="card-footer bg-white border-0 py-3">
            <nav aria-label="Page navigation">
                <ul class="pagination pagination-sm justify-content-center m-0">
                    @for(int i = 1; i <= ViewBag.TotalPages; i++) {
                        <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                            <a class="page-link" href="@Url.Action("Index", new { page = i, search = ViewBag.CurrentSearch, sortOrder = ViewBag.CurrentSort })">@i</a>
                        </li>
                    }
                </ul>
            </nav>
        </div>
    }
</div>